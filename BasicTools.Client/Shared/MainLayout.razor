@inherits LayoutComponentBase
@implements IDisposable

<CascadingValue Value="this">
    <div class="page">
        <div class="sidebar">
            <NavMenu />
        </div>

        <div class="main">
            @*<div class="top-row px-4">
                    <a href="http://blazor.net" target="_blank" class="ml-md-auto">About</a>
                </div>*@

            <div class="content px-4">
                @Body
            </div>
        </div>

        @if (_rightSidebar != null)
        {
            <div class="sidebar text-white p-2">
                @_rightSidebar
            </div>
        }
    </div>
</CascadingValue>

@code {
    private RenderFragment _rightSidebar;

    private bool _disposed = false;

    public void SetRenderFragments(RenderFragment rightSidebar)
    {
        if (_disposed)
            return;

        _rightSidebar = rightSidebar;
        StateHasChanged();
    }

    public void ClearRenderFragments(RenderFragment rightSidebar)
    {
        if (_disposed)
            return;

        InvokeAsync(() =>
        {
            if (_rightSidebar == rightSidebar)
            {
                _rightSidebar = null;
                StateHasChanged();
            }
        });
    }

    public void Dispose()
    {
        _disposed = true;
    }
}
